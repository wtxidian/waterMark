!(function($){		var Sandbox,	configs = {		end:0	};	function wmProduct( info ) {		this.init(info);	}		$.extend(wmProduct.prototype,{						init: function(info) {			this.info = info;			this.id = info.num_iid;			this.imageurl = info.pic_url;			this.wm = new SaleKing.Business.WM(); // WM on the product		},		generateDomElement: function(container) {			var html = $('<div class="productWrapper">' +							'<a href="javascript:;" class="product" id="' + this.id + '">' +								'<img class="productImage" src="' + this.imageurl + '_70x70.jpg" />' +							'</a>' +							'<a href="javascript:;" class="deleteProduct">删除商品</a>' +						'</div>');			this.domelement = $(".product", html);			container.append(html);			this._applyWMBasics();			return html;		},		_applyWMBasics: function() {			if(typeof this.domelement === "undefined") {				return false;			}			$(".wmBasic", this.domelement).remove();			for(var i=0, max=this.wm.basics.length; i<max; i++) {				this.wm.basics[i].applyToContainer(this.domelement, false);			}			return true;		},		end:0	});	SaleKing.Business.wmProduct = wmProduct;})(jQuery);///////////////////////////////////////////////////////////////////////////////////////////////////////////productPreview////////////////////////////////////////////!(function($){		var Sandbox,	configs = {		end:0	};	function wmProductPreview( domelement, imageelement, imgModifyArea, textModifyArea, findProductInList ) {		this.init(domelement, imageelement, imgModifyArea, textModifyArea, findProductInList);	}		$.extend(wmProductPreview.prototype,{						init: function(domelement, imageelement, imgModifyArea, textModifyArea, findProductInList) {					this.domelement = domelement;			this.image = imageelement;			this.imgModifyArea = imgModifyArea;			this.textModifyArea = textModifyArea;			this.findProductInList = findProductInList;						this.productid = -1;			this.selectedBasic = {};			this.wm = {};			this.textPanel = null;			this.loading = false;			var instance = this;						this.domelement.bind("dragoutside", function(event, basic) {  // remove element				instance.removeBasic(basic);			});			$("body").bind("click", function(event) {				var target = $(event.target);				var basic = instance.selectedBasic;				if(typeof basic !== "undefined") {					if( basic.type == 'text' && (target.hasClass("mzc_inner") || target.hasClass("mzc_pageWrapper") || target.hasClass("imagewrapper") || target.parent().hasClass("imagewrapper"))) {						delete instance.selectedBasic;						instance.textPanel.deselect();						instance._applyWMBasics();					}					else if( basic.type == 'image' && (target[0].tagName !== 'A' || target.attr("rel") !== '#wmstab') ) {						delete instance.selectedBasic;						instance._applyWMBasics();					}				}			});			$(this.domelement).bind("addnewwatermark", function(event, item) {				for(var i=0, max=item.length; i<max; i++) {					instance.wm.addBasic(item[i]);				}				instance._applyWMBasics();				instance.domelement.trigger("changed");			});			$(this.domelement).bind("changed", function(event) {				instance._changeProduct();			});		},				setText:function(textPanel){			this.textPanel = textPanel;		},				removeBasic: function(basic) {			$("#tooltip").remove();			this.wm.removeBasicByHash(basic.hash);			delete this.selectedBasic;			this.textPanel.deselect();			this._applyWMBasics();			this._changeProduct();		},		showProduct: function(product) {			// update class parameters			this.wm = new SaleKing.Business.WM();			this.wm.basics = product.wm.clone();			this.productid = product.id;			var instance = this;			// update dom elements			$(".wmBasic", this.domelement).remove();			this.image.attr("src", "./i/loadingPage3.gif");			$("<img/>").load(function() {				if(instance.productid != product.id) {					return false;				}				instance.image.attr("src", product.imageurl + "_310x310.jpg");				instance._applyWMBasics();			}).attr("src", product.imageurl + "_310x310.jpg");		},		_changeProduct: function() {			// apply wm in preview product wm to the original product			var pid = this.productid;			var product = this.findProductInList(pid);			product.wm.basics = this.wm.clone();			product._applyWMBasics();		},		_applyWMBasics: function() {			if(typeof this.wm.basics === "undefined") {				return false;			}			$(".wmBasic", this.domelement).remove();			for(var i=0, max=this.wm.basics.length; i<max; i++) {				// generate wm in preview area				this.wm.basics[i].applyToContainer(this.domelement, true);			}			if(typeof this.selectedBasic !== "undefined") {				var basic = this.wm.selectBasicByHash(this.selectedBasic.hash);				if(typeof basic.element !== "undefined") {					basic.element.addClass("selected");				}			}			var instance = this;			$(".wmBasic", this.domelement).bind("click", function(event) { // 单击选中				instance.loading = true;				var archor = $(this);				var hash = archor.data("hash");				var basic = instance.wm.selectBasicByHash(hash);				instance.selectedBasic = basic;				instance._applyWMBasics();				if(basic.type === "text") {					instance.textPanel.applyBasic(basic);				}				else if(basic.type === "image") {					$(".wmShelf .tabs a:eq(0)").trigger("click");				}				instance.loading = false;				return false;			});		},		_addToImgModifyList: function(nowwm) {			var ele = $('<div class="wmimage">' +							'<div class="imagewrapper">' +								'<img src="' + nowwm.imageurl + '" />' +							'</div>' +						'</div>');			$(".wmimage:last", this.imgModifyArea).before(ele);		},		end:0	});	SaleKing.Business.wmProductPreview = wmProductPreview;})(jQuery);